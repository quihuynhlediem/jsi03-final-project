<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="tab-title"></title>
  <link rel="stylesheet" href="../static/css/navbar.css">
  <link rel="stylesheet" href="../static/css/blog-detail.css">
  <link rel="stylesheet" href="../static/css/comments.css">
  <link rel="stylesheet" href="../static/css/footer.css">
  <!-- Navbar Additional Links Start -->
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />

  <!-- CSS stylesheet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
    integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
  <!-- Navbar Additional Links End -->
</head>

<body>
  <!-- Messenger Plugin chat Code Starts -->
  <div id="fb-root"></div>

  <!-- Your Plugin chat code -->
  <div id="fb-customer-chat" class="fb-customerchat">
  </div>

  <script>
    var chatbox = document.getElementById('fb-customer-chat');
    chatbox.setAttribute("page_id", "109950078861537");
    chatbox.setAttribute("attribution", "biz_inbox");
  </script>

  <!-- Your SDK code -->
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        xfbml: true,
        version: 'v18.0'
      });
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/vi_VN/sdk/xfbml.customerchat.js';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
  <!-- Messenger Plugin chat Code Ends -->


  <!-- Navbar Start -->
  <div class="navbar-body">
    <!-- Navbar expands from large and collapses from size smaller than large -->
    <div class="sticky-top">
      <nav class="navbar navbar-expand-lg navbar-collapse-md" id="navbar-id">
        <!-- Navbar spans the entire width of any viewport -->
        <div class="container-fluid" id="container-all">
          <a href="#" class="navbar-brand">
            <!-- The logo is inline with the title but also the width and height of the logo is changeable-->
            <img src="../static/images/logo.png" alt="Logo" class="title-logo d-inline-block" />
          </a>

          <!-- Navbar Toggle contains the elements inside the list with the id of "navbarToggler" -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler"
            aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <!-- The list -->

          <div class="collapse navbar-collapse" id="navbarToggler">
            <!-- The list is right-aligned (ms-auto)  -->
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0" id="nav-list">
              <li class="nav-item">
                <a class="nav-link" href="../index.html">Trang chủ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./courses.html">Khoá học</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./blog.html">Blogs</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="./contact.html">Liên hệ
                </a>
              </li>

              <li class="nav-item" id="signin-remove-item">
                <a class="nav-link" aria-current="page" href="./signin.html">Đăng nhập
                </a>
              </li>

              <li class="nav-item" id="signup-remove-item">
                <a class="nav-link" aria-current="page" href="./signup.html">Đăng kí
                </a>
              </li>

              <li class="nav-item" id="profile_nav_item">
                <a class="nav-link" aria-current="page" href="./profile.html">Hồ sơ
                </a>
              </li>

              <li class="nav-item" id="logout_nav_item">
                <div class="nav-link" aria-current="page" href="#" >Đăng xuất
                </div>
              </li>

            </ul>
          </div>
        </div>
      </nav>
    </div>

    <!-- JS bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"></script>
    <script>
      // Get the current page URL
      const currentPageUrl = window.location.href;

      // Loop through all nav links and add the 'active' class to the one that matches the current page URL
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach((link) => {
        if (link.href === currentPageUrl) {
          link.classList.add('active');
        }
      });
    </script>
  </div>
  <!-- Navbar End -->


  <!-- Blog Detail Starts -->
  <!-- Post content-->
  <section class="post-header" style="background-image: url('../static/images/blog-background.png')">
    <div class="header-content post-container">
      <!--Title-->
      <a class="back-link" href="./blog.html">Trở lại trang Blog</a>
      <h1 class="header-title"></h1>
      <!--Post Image-->
      <img src="" alt="" class="header-img">
    </div>
  </section>


  <!--Post-->
  <section class="post-content post container">
  </section>

  <div class="comment-box">
    <div class="comment-box-container">
      <img id="user-avatar-cmt" alt="Avatar" src="../../static/images/avatar.jpeg">
      <form class="form-container">
        <div class="rating">
          <input type="radio" id="star1" name="rating" value="1" />
          <label class="star-label" for="star1" onmouseover="starMouseover()"
            onmouseout="starMouseout()">&#9734;</label>
          <input type="radio" id="star2" name="rating" value="2" />
          <label class="star-label" for="star2" onmouseover="starMouseover()"
            onmouseout="starMouseout()">&#9734;</label>
          <input type="radio" id="star3" name="rating" value="3" />
          <label class="star-label" for="star3" onmouseover="starMouseover()"
            onmouseout="starMouseout()">&#9734;</label>
          <input type="radio" id="star4" name="rating" value="4" />
          <label class="star-label" for="star4" onmouseover="starMouseover()"
            onmouseout="starMouseout()">&#9734;</label>
          <input type="radio" id="star5" name="rating" value="5" />
          <label class="star-label" for="star5" onmouseover="starMouseover()"
            onmouseout="starMouseout()">&#9734;</label>
        </div>

        <!-- <label for="comment">Leave a comment:</label> -->
        <!-- This is a textarea input field for users to leave their comments on a blog post. -->
        <textarea id="comment" name="comment" placeholder="Bạn nghĩ gì về bài viết này?"></textarea>


      </form>

    </div>
    <div class="button-container">
      <button type="submit" class="submit-btn">Bình luận</button>
      <button type="cancel" class="cancel-btn">Huỷ</button>
    </div>

  </div>
  <div class="comments-container">

  </div>

  <!-- Blog Detail Ends -->


  <!-- Footer Starts -->
  <footer class="footer" id="footer">
    <div class="footer-content">
      <h4>MindX Technology School</h4>
      <p>
        MindX định hướng phát triển trở thành hệ sinh thái giáo dục và khởi nghiệp - Trung tâm nhân tài Công nghệ toàn
        cầu. Bắt đầu từ Việt Nam, chúng tôi không ngừng nỗ lực tạo ra những Silicon Valley thu nhỏ để nuôi dưỡng tài
        năng công nghệ trẻ cho đất nước và thế giới.
      </p>
    </div>

    <div class="footer-social">
      <a href="https://www.facebook.com/mindxschool"><i class="fa-brands fa-facebook footer-icon"></i></a>

      <a href="https://www.instagram.com"><i class="fa-brands fa-instagram footer-icon"></i></a>

      <a href="https://www.linkedin.com"><i class="fa-brands fa-linkedin footer-icon"></i></a>
    </div>

    <div class="footer-bottom">
      <div class="footer-flex-item">
        <p class="copyright-text">
          Bản quyền thuộc về &copy; <a class="footer-link" href="#">mindxeducation</a>
        </p>
      </div>
      <div class="footer-flex-item">
        <div class="footer-menu">
          <p><a class="footer-link" href="">Trang Chủ</a></p>
          <p><a class="footer-link" href="">Về Chúng Tôi</a></p>
          <p><a class="footer-link" href="">Liên Hệ</a></p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://kit.fontawesome.com/550795c27f.js" crossorigin="anonymous"></script>
  <!-- Footer Ends -->

  <script src="../js/change-navbar.js"></script>
  <script src="../js/blog-detail-data.js"></script>
  <script src="../js/comments.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import {
      getDatabase,
      set,
      ref,
      update,
      onValue,
      get
    } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAXfA8LBTNMME0x_PfPNNJMDk-Ctj7ON08",
      authDomain: "mindxeducation-user.firebaseapp.com",
      projectId: "mindxeducation-user",
      storageBucket: "mindxeducation-user.appspot.com",
      messagingSenderId: "338853320135",
      appId: "1:338853320135:web:950c0a7740ff19575e35e2",
      measurementId: "G-SHRT0GS1L0"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    let submitBtn = document.querySelector(".submit-btn");
    let comments = JSON.parse(localStorage.getItem("comments"));

    setTimeout(function () {
      console.log("Updated");
    }, 2000);

    onValue(ref(database, "/"), (snapshot) => {
      if (snapshot.val().hasOwnProperty('blog_comments') == true) {
        let data = snapshot.val().blog_comments;
        localStorage.setItem("comments", JSON.stringify(data));
      }
    });

    submitBtn.addEventListener("click", function () {
      if (localStorage.getItem("username") != null) {
        if (commentContent.value == "") {
          alert("Please enter your comment!");
        } else {
          let username = localStorage.getItem("username");
          let userAvatar = localStorage.getItem("avatar");
          let dt = new Date();
          let date =
            dt.getFullYear() + "-" + (dt.getMonth() + 1) + "-" + dt.getDate();

          renderComment(username, date, starValue, commentContent.value);

          // Store cmt data in localStorage Starts
          let currentComment = {
            username: username,
            user_avatar: userAvatar,
            date: date,
            rating: starValue,
            content: commentContent.value,
          };

          let commentsObj;
          let commentsArray;
          if (localStorage.getItem("comments") === null) {
            commentsObj = {};
          } else {
            commentsObj = JSON.parse(localStorage.getItem("comments"));
          }

          if (commentsObj[blogid] === null || commentsObj[blogid] === undefined) {
            commentsArray = [];
          } else {
            commentsArray = commentsObj[blogid];
          }

          commentsArray.push(currentComment);
          commentsObj[blogid] = commentsArray;
          localStorage.setItem("comments", JSON.stringify(commentsObj));
          // Store cmt data in localStorage Ends
          setTimeout(function () {
            commentContent.value = "";
            starValue = 0;
            for (i = 0; i < 5; i++) {
              starLabel[i].innerHTML = "&#9734;";
            }
          }, 1000);
        }
      } else {
        alert("Vui lòng đăng nhập để bình luận");
        window.location.href = "signin.html";
      }
      // Update comments to localStorage
      let comments = JSON.parse(localStorage.getItem("comments"));
      update(ref(database, "/"), {
        blog_comments: comments
      });
    });

    // if (comments == null || comments == undefined) {
    //   onValue(ref(database, "/"), (snapshot) => {
    //     if (snapshot.val().hasOwnProperty('blog_comment') == true) {
    //       let data = snapshot.val().blog_comments;
    //       localStorage.setItem("comments", JSON.stringify(data));
    //     }
    //     setTimeout(function () {
    //       console.log("Updated");
    //     }, 2000);
    //   });
    // }

  </script>

</body>

</html>