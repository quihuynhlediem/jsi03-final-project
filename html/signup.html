<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Đăng kí</title>
  <link rel="stylesheet" href="../static/css/navbar.css">
  <link rel="stylesheet" href="../static/css/signin.css">
  <link rel="stylesheet" href="../static/css/footer.css">
  <!-- Navbar Additional Links Start -->
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />

  <!-- CSS stylesheet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
    integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
  <!-- Navbar Additional Links End -->
</head>

<body>
  <!-- Messenger Plugin chat Code Starts -->
  <div id="fb-root"></div>

  <!-- Your Plugin chat code -->
  <div id="fb-customer-chat" class="fb-customerchat">
  </div>

  <script>
    var chatbox = document.getElementById('fb-customer-chat');
    chatbox.setAttribute("page_id", "109950078861537");
    chatbox.setAttribute("attribution", "biz_inbox");
  </script>

  <!-- Your SDK code -->
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        xfbml: true,
        version: 'v18.0'
      });
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/vi_VN/sdk/xfbml.customerchat.js';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
  <!-- Messenger Plugin chat Code Ends -->

  
  <!-- Navbar Start -->
  <div class="navbar-body">
    <!-- Navbar expands from large and collapses from size smaller than large -->
    <div class="sticky-top">
      <nav class="navbar navbar-expand-lg navbar-collapse-md" id="navbar-id">
        <!-- Navbar spans the entire width of any viewport -->
        <div class="container-fluid" id="container-all">
          <a href="#" class="navbar-brand">
            <!-- The logo is inline with the title but also the width and height of the logo is changeable-->
            <img src="../static/images/logo.png" alt="Logo" class="title-logo d-inline-block" />
          </a>

          <!-- Navbar Toggle contains the elements inside the list with the id of "navbarToggler" -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler"
            aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <!-- The list -->

          <div class="collapse navbar-collapse" id="navbarToggler">
            <!-- The list is right-aligned (ms-auto)  -->
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0" id="nav-list">
              <li class="nav-item">
                <a class="nav-link" href="../index.html">Trang chủ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="courses.html">Khoá học</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="blog.html">Blogs</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="contact.html">Liên hệ
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="signin.html">Sign In
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="signup.html">Sign Up
                </a>
              </li>

            </ul>
          </div>
        </div>
      </nav>
    </div>

    <!-- JS bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"></script>
    <script>
      // Get the current page URL
      const currentPageUrl = window.location.href;

      // Loop through all nav links and add the 'active' class to the one that matches the current page URL
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach((link) => {
        if (link.href === currentPageUrl) {
          link.classList.add('active');
        }
      });
    </script>
  </div>
  <!-- Navbar End -->


  <!-- Sign Up Starts -->

  <div class="register_body">
    <div id="registerForm">
      <h1>Sign Up</h1>
      <input type="text" placeholder="Enter your username" id="usernameSignup" />
      <input type="text" placeholder="Enter your email" id="emailSignup" />
      <input type="text" placeholder="Enter your password" id="passwordSignup" />
      <label for="avatarSignup">Choose a profile picture:</label>
      <input type="file" id="avatarSignup" />
      <div class="remember">
        <input type="checkbox" id="remember" />
        <label for="remember">Remember me</label>
        <!-- Luu username + pass vao localStorage -->
      </div>
      <button id="signUp">Submit</button>
      <div class="change_tab">
        <p>Already had an account? <a href="signin.html">Sign In</a></p>
      </div>
    </div>
  </div>
  <!-- Sign Up Ends -->


  <!-- Footer Starts -->
  <footer class="footer" id="footer">
    <div class="footer-content">
      <h4>MindX Technology School</h4>
      <p>
        MindX định hướng phát triển trở thành hệ sinh thái giáo dục và khởi nghiệp - Trung tâm nhân tài Công nghệ toàn
        cầu. Bắt đầu từ Việt Nam, chúng tôi không ngừng nỗ lực tạo ra những Silicon Valley thu nhỏ để nuôi dưỡng tài
        năng công nghệ trẻ cho đất nước và thế giới.
      </p>
    </div>

    <div class="footer-social">
      <a href="https://www.facebook.com/mindxschool"><i class="fa-brands fa-facebook footer-icon"></i></a>

      <a href="https://www.instagram.com"><i class="fa-brands fa-instagram footer-icon"></i></a>

      <a href="https://www.linkedin.com"><i class="fa-brands fa-linkedin footer-icon"></i></a>
    </div>

    <div class="footer-bottom">
      <div class="footer-flex-item">
        <p class="copyright-text">
          Bản quyền thuộc về &copy; <a class="footer-link" href="#">mindxeducation</a>
        </p>
      </div>
      <div class="footer-flex-item">
        <div class="footer-menu">
          <p><a class="footer-link" href="">Trang Chủ</a></p>
          <p><a class="footer-link" href="">Về Chúng Tôi</a></p>
          <p><a class="footer-link" href="">Liên Hệ</a></p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://kit.fontawesome.com/550795c27f.js" crossorigin="anonymous"></script>
  <!-- Footer Ends -->

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import {
      getDatabase,
      set,
      ref,
      update,
      onValue,
      get
    } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
    } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
    import { getStorage, ref as refStorage, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAXfA8LBTNMME0x_PfPNNJMDk-Ctj7ON08",
      authDomain: "mindxeducation-user.firebaseapp.com",
      projectId: "mindxeducation-user",
      storageBucket: "mindxeducation-user.appspot.com",
      messagingSenderId: "338853320135",
      appId: "1:338853320135:web:950c0a7740ff19575e35e2",
      measurementId: "G-SHRT0GS1L0"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();
    const storage = getStorage(app);

    // sign up
    let signUp = document.getElementById("signUp");
    let signUpImg = document.getElementById("avatarSignup");

    signUpImg.addEventListener("change", function (e) {
      let file = e.target.files[0];
      let storageRef = refStorage(storage, "images/" + file.name);
      uploadBytes(storageRef, file).then((snapshot) => {
        console.log("Uploaded a blog or file!");
        getDownloadURL(snapshot.ref).then((url) => {
          console.log(url);
          localStorage.setItem("avatar", url);
        });
      });
    });
    signUp.addEventListener("click", function () {
      let username = document.getElementById("usernameSignup").value;
      let email = document.getElementById("emailSignup").value;
      let password = document.getElementById("passwordSignup").value;
      let imgUrl = localStorage.getItem("avatar");

      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed in
          const user = userCredential.user;
          set(ref(database, "users/" + user.uid), {
            username: username,
            email: email,
            courses: [],
            avatar: imgUrl,
          });
          alert("Account created");
          username = "";
          email = "";
          password = "";
          signUpImg.value = "";
          setTimeout(function () {
            window.open("./signin.html", "_self");
          }, 2000);
        })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;

          alert(errorMessage);
        });
    });

    // login
    let login = document.getElementById("login");
    login.addEventListener("click", function () {
      let email = document.getElementById("usernameLogin").value;
      let password = document.getElementById("passwordLogin").value;

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Signed in
          let dt = new Date();
          const user = userCredential.user;
          update(ref(database, "users/" + user.uid), {
            lastLogin: dt,
          });

          onValue(ref(database, "users/" + user.uid), function (snapshot) {
            localStorage.setItem("username", snapshot.val().username);
          });

          alert("User login success");
          localStorage.setItem("email", email);
          setTimeout(function () {
            window.open("../index.html", "_self");
          }, 2000);
        })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          alert(errorMessage);
        });
    });

  </script>
</body>

</html>